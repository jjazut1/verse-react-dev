<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PWA Deep Link Test</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    .test-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
    .result {
      background: #e9ecef;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      font-family: monospace;
    }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
  </style>
</head>
<body>
  <h1>🔬 PWA Deep Link Navigation Test</h1>
  
  <div class="test-section">
    <h2>Test Assignment Link Navigation</h2>
    <p>This page simulates the PWA deep link restoration process to test if assignment tokens properly navigate to the game.</p>
    
    <div>
      <h3>Step 1: Simulate Deep Link Storage</h3>
      <button onclick="storeDeepLink()">Store Token: ?token=test-assignment-123</button>
      <div id="store-result" class="result"></div>
    </div>
    
    <div>
      <h3>Step 2: Simulate PWA Launch</h3>
      <p>This simulates when the PWA opens and tries to restore the deep link parameters:</p>
      <button onclick="simulatePWARestore()">Simulate PWA Restoration</button>
      <div id="restore-result" class="result"></div>
    </div>
    
    <div>
      <h3>Step 3: Test Navigation</h3>
      <button onclick="testNavigation()">Test Direct Navigation</button>
      <div id="nav-result" class="result"></div>
    </div>
  </div>
  
  <div class="test-section">
    <h2>Debug Information</h2>
    <button onclick="showDebugInfo()">Show Current State</button>
    <div id="debug-info" class="result"></div>
  </div>

  <script>
    function log(message, type = 'info') {
      console.log(`[PWA Test] ${message}`);
      const resultDiv = document.getElementById('store-result');
      if (resultDiv) {
        resultDiv.textContent = message;
        resultDiv.className = `result ${type}`;
      }
    }
    
    function storeDeepLink() {
      const params = '?token=test-assignment-123';
      localStorage.setItem('deepLinkParams', params);
      
      const result = document.getElementById('store-result');
      result.textContent = `✅ Stored deep link params: ${params}`;
      result.className = 'result success';
      
      console.log('Deep link params stored:', params);
    }
    
    function simulatePWARestore() {
      // Simulate the PWA hook restoration logic
      const savedParams = localStorage.getItem('deepLinkParams');
      const resultDiv = document.getElementById('restore-result');
      
      if (!savedParams) {
        resultDiv.textContent = '❌ No saved params found. Run Step 1 first.';
        resultDiv.className = 'result error';
        return;
      }
      
      // Parse the saved parameters (simulate the fix)
      const urlParams = new URLSearchParams(savedParams);
      const token = urlParams.get('token');
      
      if (token) {
        // If there's a token, navigate to the play route
        const targetUrl = `/play?token=${token}`;
        resultDiv.textContent = `✅ Token detected! Would navigate to: ${targetUrl}`;
        resultDiv.className = 'result success';
        
        localStorage.removeItem('deepLinkParams');
        console.log('PWA restoration would navigate to:', targetUrl);
      } else {
        resultDiv.textContent = '❌ No token found in saved params';
        resultDiv.className = 'result error';
      }
    }
    
    function testNavigation() {
      const token = 'test-assignment-123';
      const targetUrl = `/play?token=${token}`;
      
      const resultDiv = document.getElementById('nav-result');
      resultDiv.textContent = `🚀 Would navigate to: ${targetUrl}`;
      resultDiv.className = 'result success';
      
      // For testing, just log instead of actually navigating
      console.log('Test navigation to:', targetUrl);
      
      // Option to actually navigate (uncomment for real test)
      // window.location.href = targetUrl;
    }
    
    function showDebugInfo() {
      const debugInfo = {
        currentURL: window.location.href,
        savedParams: localStorage.getItem('deepLinkParams'),
        isStandalone: window.matchMedia('(display-mode: standalone)').matches,
        hasServiceWorker: 'serviceWorker' in navigator,
        userAgent: navigator.userAgent.substring(0, 100) + '...'
      };
      
      const resultDiv = document.getElementById('debug-info');
      resultDiv.textContent = JSON.stringify(debugInfo, null, 2);
      resultDiv.className = 'result';
      
      console.log('Debug info:', debugInfo);
    }
    
    // Auto-run debug info on load
    window.addEventListener('load', () => {
      showDebugInfo();
    });
  </script>
</body>
</html> 